{%- comment -%}
  Free Shipping Progress Bar
  Gamified cart drawer element showing progress to free shipping.
  
  Usage: {% render 'free-shipping-bar', cart: cart %}
  
  Configure threshold: Change 5000 to your free shipping threshold in cents (Â£50 = 5000)
{%- endcomment -%}

{%- liquid
  assign threshold = 5000
  
  comment
    SAFETY: Prevent division by zero
  endcomment
  if threshold == 0 or threshold == blank
    assign threshold = 1
  endif
  
  assign threshold_money = threshold | money_without_trailing_zeros
  assign remaining = threshold | minus: cart.total_price
  assign remaining_money = remaining | money_without_trailing_zeros
  
  if cart.total_price >= threshold
    assign progress = 100
    assign qualified = true
  else
    assign progress = cart.total_price | times: 100 | divided_by: threshold
    assign qualified = false
  endif
-%}

<div class="aurea-shipping-bar">
  <div class="aurea-shipping-bar__progress" style="width: {{ progress }}%;"></div>
  
  <div class="aurea-shipping-bar__text">
    {% if qualified %}
      <span class="aurea-shipping-bar__icon">ðŸŽ‰</span>
      <span>You've unlocked <strong>FREE SHIPPING!</strong></span>
    {% elsif cart.item_count > 0 %}
      <span class="aurea-shipping-bar__icon">ðŸšš</span>
      <span>Add <strong>{{ remaining_money }}</strong> more for FREE shipping</span>
    {% else %}
      <span class="aurea-shipping-bar__icon">ðŸšš</span>
      <span>Free shipping on orders over <strong>{{ threshold_money }}</strong></span>
    {% endif %}
  </div>
</div>

<style>
  .aurea-shipping-bar {
    position: relative;
    background: #F3F3F3;
    border-radius: 20px;
    overflow: hidden;
    height: 36px;
    margin: 12px 0;
  }
  
  .aurea-shipping-bar__progress {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    background: linear-gradient(90deg, #D4AF37 0%, #B8860B 100%);
    border-radius: 20px;
    transition: width 0.4s ease;
  }
  
  .aurea-shipping-bar__text {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    height: 100%;
    font-size: 0.85rem;
    color: #1A1A1A;
    padding: 0 16px;
  }
  
  .aurea-shipping-bar__icon {
    font-size: 1rem;
  }
</style>
