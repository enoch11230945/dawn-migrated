{%- comment -%}
  AUREA Smart Add to Cart Button
  Automatically switches button text based on inventory status
  
  Usage: {% render 'aurea-smart-atc-button', product: product, form_id: 'product-form-id' %}
  
  Behavior:
  - Inventory > 0: "Add to Bag" + "UK Stock" badge
  - Inventory = 0 + continue selling: "Pre-order Now" 
  - Inventory = 0 + cannot continue: "Sold Out" (disabled)
{%- endcomment -%}

{%- assign variant = product.selected_or_first_available_variant -%}
{%- assign is_preorder = false -%}
{%- assign is_soldout = false -%}
{%- assign is_instock = false -%}

{%- comment -%} Determine inventory status {%- endcomment -%}
{%- if variant.available -%}
  {%- if variant.inventory_management == 'shopify' and variant.inventory_quantity <= 0 -%}
    {%- comment -%} Available but no stock = Pre-order {%- endcomment -%}
    {%- assign is_preorder = true -%}
  {%- else -%}
    {%- assign is_instock = true -%}
  {%- endif -%}
{%- else -%}
  {%- assign is_soldout = true -%}
{%- endif -%}

<style>
  .aurea-atc-wrapper {
    position: relative;
    margin: 1rem 0;
  }
  
  .aurea-atc-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    width: 100%;
    padding: 1rem 2rem;
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 1rem;
    font-weight: 500;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  /* In-stock state */
  .aurea-atc-button--instock {
    background: #1A1A1A;
    color: #fff;
  }
  
  .aurea-atc-button--instock:hover {
    background: #333;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }
  
  /* Pre-order state */
  .aurea-atc-button--preorder {
    background: linear-gradient(135deg, #B8860B 0%, #D4A574 100%);
    color: #fff;
    position: relative;
    overflow: hidden;
  }
  
  .aurea-atc-button--preorder::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shine 2s infinite;
  }
  
  @keyframes shine {
    0% { left: -100%; }
    100% { left: 100%; }
  }
  
  .aurea-atc-button--preorder:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(184,134,11,0.4);
  }
  
  /* Sold out state */
  .aurea-atc-button--soldout {
    background: #E5E5E5;
    color: #999;
    cursor: not-allowed;
  }
  
  .aurea-atc-button__icon {
    width: 20px;
    height: 20px;
  }
  
  .aurea-atc-button__wishlist {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
    padding: 0.5rem;
    transition: transform 0.2s ease;
  }
  
  .aurea-atc-button__wishlist:hover {
    transform: translateY(-50%) scale(1.2);
  }
  
  .aurea-atc-subtext {
    text-align: center;
    font-family: 'Cormorant', Georgia, serif;
    font-size: 0.85rem;
    color: #666;
    margin-top: 0.5rem;
  }
  
  .aurea-atc-subtext--preorder {
    color: #B8860B;
  }
</style>

<div class="aurea-atc-wrapper">
  {%- if is_instock -%}
    <button type="submit" form="{{ form_id }}" class="aurea-atc-button aurea-atc-button--instock">
      <span>Add to Bag</span>
      <svg class="aurea-atc-button__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
        <line x1="3" y1="6" x2="21" y2="6"/>
        <path d="M16 10a4 4 0 01-8 0"/>
      </svg>
    </button>
    <p class="aurea-atc-subtext">üá¨üáß UK Stock ‚Äì Fast Dispatch</p>
    
  {%- elsif is_preorder -%}
    <button type="submit" form="{{ form_id }}" class="aurea-atc-button aurea-atc-button--preorder">
      <svg class="aurea-atc-button__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10"/>
        <polyline points="12 6 12 12 16 14"/>
      </svg>
      <span>Pre-order Now</span>
      <svg class="aurea-atc-button__icon" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
      </svg>
    </button>
    <p class="aurea-atc-subtext aurea-atc-subtext--preorder">‚è≥ Restocking soon ‚Äì Dispatches in 10-15 days</p>
    
  {%- else -%}
    <button type="button" class="aurea-atc-button aurea-atc-button--soldout" disabled>
      <span>Sold Out</span>
    </button>
    <p class="aurea-atc-subtext">Join the waitlist to be notified when back in stock</p>
  {%- endif -%}
</div>
