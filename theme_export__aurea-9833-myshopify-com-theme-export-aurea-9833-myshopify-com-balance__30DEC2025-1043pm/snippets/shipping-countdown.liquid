{%- comment -%}
  AUREA Shipping Countdown
  Shows time remaining until same-day dispatch cutoff
  
  @param deadline_hour {number} - Cutoff hour (24h format, default 14)
  @param deadline_text {string} - Text template with {time} placeholder
{%- endcomment -%}

{%- liquid
  assign deadline_hour = deadline_hour | default: 14
  assign deadline_text = deadline_text | default: 'Order within {time} for same-day dispatch'
-%}

<div class="aurea-shipping-countdown" data-deadline-hour="{{ deadline_hour }}">
  <div class="aurea-countdown__inner">
    <span class="aurea-countdown__icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10"/>
        <polyline points="12 6 12 12 16 14"/>
      </svg>
    </span>
    <span class="aurea-countdown__text" data-text-template="{{ deadline_text }}">
      {{ deadline_text | replace: '{time}', '...' }}
    </span>
  </div>
</div>

<style>
  .aurea-shipping-countdown {
    background: linear-gradient(135deg, #FAF8F5 0%, #FFF 100%);
    border: 1px solid #E8E4DF;
    border-radius: 8px;
    padding: 12px 16px;
    text-align: center;
  }
  
  .aurea-countdown__inner {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: #1A1A1A;
    font-size: 0.95rem;
  }
  
  .aurea-countdown__icon {
    color: #B8860B;
  }
  
  .aurea-countdown__text strong {
    color: #B8860B;
    font-weight: 600;
  }
  
  .aurea-countdown--expired {
    opacity: 0.6;
  }
</style>

<script>
  (function() {
    const container = document.currentScript.previousElementSibling.previousElementSibling;
    if (!container || !container.classList.contains('aurea-shipping-countdown')) return;
    
    const deadlineHour = parseInt(container.dataset.deadlineHour) || 14;
    const textEl = container.querySelector('.aurea-countdown__text');
    const template = textEl?.dataset.textTemplate || '';
    
    function updateCountdown() {
      const now = new Date();
      const deadline = new Date();
      deadline.setHours(deadlineHour, 0, 0, 0);
      
      // If after deadline, show next day
      if (now >= deadline) {
        container.classList.add('aurea-countdown--expired');
        textEl.innerHTML = 'Order now - dispatched tomorrow';
        return;
      }
      
      const diff = deadline - now;
      const hours = Math.floor(diff / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      
      let timeStr = '';
      if (hours > 0) {
        timeStr = '<strong>' + hours + 'h ' + minutes + 'm</strong>';
      } else {
        timeStr = '<strong>' + minutes + ' minutes</strong>';
      }
      
      textEl.innerHTML = template.replace('{time}', timeStr);
    }
    
    updateCountdown();
    setInterval(updateCountdown, 60000); // Update every minute
  })();
</script>
