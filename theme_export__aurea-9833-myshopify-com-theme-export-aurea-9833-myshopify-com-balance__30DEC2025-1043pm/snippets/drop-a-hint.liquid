{%- comment -%}
  Drop a Hint - Viral Marketing Button
  Uses Web Share API (native) with WhatsApp fallback
  
  Usage: {% render 'drop-a-hint', product: product %}
{%- endcomment -%}

{%- liquid
  assign product_url = shop.url | append: product.url
  assign share_text = "Hey! I think I found the perfect gift... üíç‚ú®"
  assign encoded_message = share_text | append: " " | append: product_url | url_encode
-%}

<div class="aurea-drop-hint">
  <button 
    type="button"
    class="aurea-hint-btn"
    id="drop-hint-btn-{{ product.id }}"
    data-product-title="{{ product.title | escape }}"
    data-product-url="{{ product_url }}"
    data-share-text="{{ share_text }}"
    data-whatsapp-url="https://wa.me/?text={{ encoded_message }}"
  >
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8"></path>
      <polyline points="16 6 12 2 8 6"></polyline>
      <line x1="12" y1="2" x2="12" y2="15"></line>
    </svg>
    <span>Drop a Hint</span>
  </button>
  
  <p class="aurea-hint-caption">Send to someone who should see this üòâ</p>
</div>

<script>
  (function() {
    const btn = document.getElementById('drop-hint-btn-{{ product.id }}');
    if (!btn) return;
    
    btn.addEventListener('click', async function() {
      const title = this.dataset.productTitle;
      const url = this.dataset.productUrl;
      const text = this.dataset.shareText;
      const whatsappUrl = this.dataset.whatsappUrl;
      
      // Try Web Share API first (native share menu on mobile)
      if (navigator.share) {
        try {
          await navigator.share({
            title: title,
            text: text,
            url: url
          });
          return;
        } catch (err) {
          // User cancelled or error - fall through to WhatsApp
        }
      }
      
      // Fallback: Open WhatsApp
      window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
    });
  })();
</script>

<style>
  .aurea-drop-hint {
    text-align: center;
    margin: 1rem 0;
  }
  
  .aurea-hint-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    border: 2px solid #25D366;
    background: transparent;
    color: #25D366;
    border-radius: 25px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .aurea-hint-btn:hover {
    background: #25D366;
    color: #FFF;
  }
  
  .aurea-hint-caption {
    font-size: 0.75rem;
    color: #888;
    margin-top: 6px;
  }
</style>
